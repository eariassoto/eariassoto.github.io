<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Test your C&#43;&#43; code with the Google Test framework ::
        Emmanuel Arias — Blog
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="In a previous post, I showed you a C/C&#43;&#43; template that you can use for a project. I felt that it needed a basic testing framework. Therefore, we are going to learn how to install and use the Google Test framework to write tests. When we have finished this tutorial, we will have an executable that will run tests for our code.
"
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://eariassoto.github.io/post/unit-tests/" />





<link rel="stylesheet" href="https://eariassoto.github.io/assets/style.css" />

<link rel="stylesheet" href="https://eariassoto.github.io/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://eariassoto.github.io/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://eariassoto.github.io/img/favicon.png" />


<link href="https://eariassoto.github.io/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://eariassoto.github.io/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://eariassoto.github.io/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://eariassoto.github.io/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://eariassoto.github.io/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://eariassoto.github.io/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Test your C&#43;&#43; code with the Google Test framework"/>
<meta name="twitter:description" content="In a previous post, I showed you a C/C&#43;&#43; template that you can use for a project. I felt that it needed a basic testing framework. Therefore, we are going to learn how to install and use the Google Test framework to write tests. When we have finished this tutorial, we will have an executable that will run tests for our code."/>



<meta property="og:title" content="Test your C&#43;&#43; code with the Google Test framework" />
<meta property="og:description" content="In a previous post, I showed you a C/C&#43;&#43; template that you can use for a project. I felt that it needed a basic testing framework. Therefore, we are going to learn how to install and use the Google Test framework to write tests. When we have finished this tutorial, we will have an executable that will run tests for our code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://eariassoto.github.io/post/unit-tests/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-10-31T01:53:18+00:00" />
<meta property="article:modified_time" content="2017-10-31T01:53:18+00:00" /><meta property="og:site_name" content="Emmanuel Arias" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Emmanuel Arias</span
    >
    
  
</a>

    <span class="header__right">
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Test your C++ code with the Google Test framework</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2017-10-31
        </span>

        
          
        
      

      


      
    </div>

    
      <span class="post-tags">
        
          <a href="https://eariassoto.github.io/tags/c&#43;&#43;/">#C&#43;&#43;</a>&nbsp;
        
          <a href="https://eariassoto.github.io/tags/cmake/">#cmake</a>&nbsp;
        
          <a href="https://eariassoto.github.io/tags/templates/">#templates</a>&nbsp;
        
          <a href="https://eariassoto.github.io/tags/unit-test/">#unit test</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p><a href="https://eariassoto.github.io/2017/04/building-a-basic-c/c---project-template/">In a previous post</a>, I showed you a C/C++ template that you can use for a project. I felt that it needed a basic testing framework. Therefore, we are going to learn how to install and use the Google Test framework to write tests. When we have finished this tutorial, we will have an executable that will run tests for our code.</p>
<p><!-- raw HTML omitted -->Get the code on GitHub<!-- raw HTML omitted --></p>
<p>I will assume that you are familiarized with unit testing methods. In case you do not know about the Google Test framework, <a href="https://github.com/google/googletest/blob/master/googletest/docs/Primer.md">here</a> is a basic introduction to this library. This post will be more of a tutorial rather than a technical post. I plan to write about test driven development (TDD) in the future.</p>
<h2 id="requirements">Requirements</h2>
<p>We need to have installed a C/C++ compiler and CMake on our machine. Next, we need to download the C/C++ template project. <a href="https://github.com/eariassoto/cpp-project-template/tree/basic-template">Here</a> is the link to the repo where you can get it. As I mentioned before, <a href="https://eariassoto.github.io/2017/04/building-a-basic-c/c---project-template/">in this post</a> I got further into details about this template. Feel free to read it, and then come back here to continue. If you have your own CMake project, you can follow the steps and install Google Test on your own project.</p>
<h2 id="folder-structure">Folder structure</h2>
<p>Our project should look like this now:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cpp-project-template
├── CMakeLists.txt
├── include
│   ├── Greeter.h
│   ├── IPerson.h
│   └── Person.h
├── src
│   ├── greeter.cpp
│   └── main.cpp
└── tests
    ├── CMakeLists.txt
    ├── CMakeLists.txt.in
    ├── include
    │   └── mocks
    │       └── MockPerson.h
    └── src
        ├── greeterTests.cpp
        └── main.cpp
</code></pre></div><p>The <code>tests/</code> folder will contain our unit testing project. It is also a CMake project, so it has its own <code>CMakeLists.txt</code> file. The <code>tests/CMakeLists.txt.in</code> file will help us include the Google Test library.</p>
<h2 id="setting-up-cmake">Setting up CMake</h2>
<p>To include our unit testing project, we only need to add this line at the end of our <code>CMakeLists.txt</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake"><span style="color:#75715e"># Unit tests
</span><span style="color:#75715e"></span>add_subdirectory(<span style="color:#e6db74">tests</span>)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Now, let&rsquo;s go over the <code>tests/CMakeLists.txt</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">cmake_minimum_required(<span style="color:#e6db74">VERSION</span> <span style="color:#e6db74">2.8</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set (<span style="color:#e6db74">PROJECT_TEST_NAME</span> <span style="color:#f92672">${</span>PROJECT_NAME<span style="color:#f92672">}</span><span style="color:#e6db74">-ut</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Download and unpack googletest at configure time
</span><span style="color:#75715e"></span>configure_file(<span style="color:#e6db74">CMakeLists.txt.in</span> <span style="color:#e6db74">googletest-download/CMakeLists.txt</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>execute_process(<span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">&#34;${CMAKE_COMMAND}&#34;</span> <span style="color:#e6db74">-G</span> <span style="color:#e6db74">&#34;${CMAKE_GENERATOR}&#34;</span> <span style="color:#e6db74">.</span>
      <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/tests/googletest-download&#34;</span> )<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>execute_process(<span style="color:#e6db74">COMMAND</span> <span style="color:#e6db74">&#34;${CMAKE_COMMAND}&#34;</span> <span style="color:#e6db74">--build</span> <span style="color:#e6db74">.</span>
      <span style="color:#e6db74">WORKING_DIRECTORY</span> <span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/tests/googletest-download&#34;</span> )<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Add googletest directly to our build. This adds
</span><span style="color:#75715e"># the following targets: gtest, gtest_main, gmock
</span><span style="color:#75715e"># and gmock_main
</span><span style="color:#75715e"></span>add_subdirectory(<span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/googletest-src&#34;</span>
                 <span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/googletest-build&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Test folder
</span><span style="color:#75715e"></span>set (<span style="color:#e6db74">TESTS_DIR</span> <span style="color:#e6db74">tests</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Header files folder
</span><span style="color:#75715e"></span>set (<span style="color:#e6db74">INCL_DIR</span> <span style="color:#e6db74">include</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set (<span style="color:#e6db74">MOCKS_DIR</span> <span style="color:#e6db74">mocks</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>include_directories (<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TESTS_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>INCL_DIR<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>include_directories (<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>TESTS_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>INCL_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>MOCKS_DIR<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set (<span style="color:#e6db74">SRC_DIR</span> <span style="color:#e6db74">src</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set(<span style="color:#e6db74">PROY_UT_SRC</span>
    <span style="color:#f92672">${</span>SRC_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/main.cpp</span>
    <span style="color:#f92672">${</span>SRC_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/greeterTests.cpp</span>
)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set (<span style="color:#e6db74">MAIN_SRC_DIR</span> <span style="color:#e6db74">../src</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>include_directories (<span style="color:#f92672">${</span>PROJECT_SOURCE_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/</span><span style="color:#f92672">${</span>INCL_DIR<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Include all project source files here
</span><span style="color:#75715e"></span>set (<span style="color:#e6db74">MAIN_SOURCE</span> 
    <span style="color:#f92672">${</span>MAIN_SRC_DIR<span style="color:#f92672">}</span><span style="color:#e6db74">/greeter.cpp</span>
)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>add_executable (<span style="color:#f92672">${</span>PROJECT_TEST_NAME<span style="color:#f92672">}</span> <span style="color:#f92672">${</span>PROY_UT_SRC<span style="color:#f92672">}</span> <span style="color:#f92672">${</span>MAIN_SOURCE<span style="color:#f92672">}</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>set_target_properties(<span style="color:#f92672">${</span>PROJECT_TEST_NAME<span style="color:#f92672">}</span>
                      <span style="color:#e6db74">PROPERTIES</span>
                      <span style="color:#e6db74">COMPILE_FLAGS</span> <span style="color:#e6db74">&#34;-std=c++11 -Wall -Werror&#34;</span>
)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Link libraries
</span><span style="color:#75715e"></span>target_link_libraries(<span style="color:#f92672">${</span>PROJECT_TEST_NAME<span style="color:#f92672">}</span>
                      <span style="color:#e6db74">gtest</span>
                      <span style="color:#e6db74">gmock_main</span>
)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>There are several ways I could have included the Google Test library in the project. The <code>find_package</code> command would have done it just fine, but the library needs to be installed in the computer. Another option would have been to manually copy the library in my project and compile it there. Luckily, I found a cleaner and more portable way to install the library. We will tell CMake to automatically clone and compile the library when it builds the project.</p>
<p>The line 5 of <code>tests/CMakeLists.txt</code> is copying <code>tests/CMakeLists.txt.in</code> to a subdirectory under <code>build/</code>. This file has the information to download Google Tests as an external project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmake" data-lang="cmake">cmake_minimum_required(<span style="color:#e6db74">VERSION</span> <span style="color:#e6db74">2.8.2</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>project(<span style="color:#e6db74">googletest-download</span> <span style="color:#e6db74">NONE</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>include(<span style="color:#e6db74">ExternalProject</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>ExternalProject_Add(<span style="color:#e6db74">googletest</span>
  <span style="color:#e6db74">GIT_REPOSITORY</span>    <span style="color:#e6db74">https://github.com/google/googletest.git</span>
  <span style="color:#e6db74">GIT_TAG</span>           <span style="color:#e6db74">master</span>
  <span style="color:#e6db74">SOURCE_DIR</span>        <span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/googletest-src&#34;</span>
  <span style="color:#e6db74">BINARY_DIR</span>        <span style="color:#e6db74">&#34;${CMAKE_BINARY_DIR}/googletest-build&#34;</span>
  <span style="color:#e6db74">CONFIGURE_COMMAND</span> <span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#e6db74">BUILD_COMMAND</span>     <span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#e6db74">INSTALL_COMMAND</span>   <span style="color:#e6db74">&#34;&#34;</span>
  <span style="color:#e6db74">TEST_COMMAND</span>      <span style="color:#e6db74">&#34;&#34;</span>
)<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Lines 6-9 of <code>tests/CMakeLists.txt</code> execute the commands that download and build the library. Lines 13-14 add the library as a submodule. Finally, the linking of the library is made in lines 44-47. Notice that this library will only be available to our unit testing project.</p>
<p>The rest of the <code>tests/CMakeLists.txt</code> file should be familiar to you. Similarly to our main project, your can keep your headers in <code>tests/include</code> and your source code in <code>tests/src</code>. It is important that you also include the headers and source files of your main project. Otherwise, your tests will fail to compile.</p>
<p>We need a main function for out unit testing project&rsquo;s executable file. This function will search for tests and run them all:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;gtest/gtest.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
  testing<span style="color:#f92672">::</span>InitGoogleTest(<span style="color:#f92672">&amp;</span>argc, argv);
  <span style="color:#66d9ef">return</span> RUN_ALL_TESTS();
}
</code></pre></div><p>And that is pretty much it. We do not need additional commands to compile our unit testing project. After we build the main project, the executable for the unit tests will be under the <code>bin/</code> folder. The executable is named like the main project, but it will have the <code>-ut</code> suffix.</p>
<h2 id="a-simple-example">A simple example</h2>
<p>To give you a small example of unit testing with Google Test, let&rsquo;s make a simple program to greet people. We want to encapsulate the person&rsquo;s data, and then pass it to our greeter.</p>
<p>As you can imagine, we will implement classes <code>Person</code> and <code>Greeter</code>. Additionally, we will abstract <code>Person</code>&rsquo;s implementation in the interface <code>IPerson</code>. With this, <code>Greeter</code> can take any <code>IPerson</code> implementation. Using interfaces to handle dependencies between classes makes our classes independent of each other. Furthermore, it makes our code more easy to maintain and test.</p>
<p>Without more, let&rsquo;s see the code for out program:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#ifndef __IPERSON__H__
</span><span style="color:#75715e">#define __IPERSON__H__
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IPerson</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>IPerson(){};
  <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">::</span>string getName() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
};
<span style="color:#75715e">#endif </span><span style="color:#75715e">/** __IPERSON__H__ */</span><span style="color:#75715e">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#ifndef __PERSON__H__
</span><span style="color:#75715e">#define __PERSON__H__
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;IPerson.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> IPerson {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  Person(std<span style="color:#f92672">::</span>string name) <span style="color:#f92672">:</span> name(name){};
  <span style="color:#f92672">~</span>Person(){};

  std<span style="color:#f92672">::</span>string getName() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> name; };

<span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
  std<span style="color:#f92672">::</span>string name;
};
<span style="color:#75715e">#endif </span><span style="color:#75715e">/** __PERSON__H__ */</span><span style="color:#75715e">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#ifndef __GREETER__
</span><span style="color:#75715e">#define __GREETER__
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;IPerson.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Greeter</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  std<span style="color:#f92672">::</span>string greet();
  std<span style="color:#f92672">::</span>string greetTo(IPerson <span style="color:#f92672">&amp;</span>person);
};
<span style="color:#75715e">#endif </span><span style="color:#75715e">/* __GREETER__ */</span><span style="color:#75715e">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Greeter.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
std<span style="color:#f92672">::</span>string Greeter<span style="color:#f92672">::</span>greet() { <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello world!&#34;</span>; }

std<span style="color:#f92672">::</span>string Greeter<span style="color:#f92672">::</span>greetTo(IPerson <span style="color:#f92672">&amp;</span>person) {
  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hi &#34;</span> <span style="color:#f92672">+</span> person.getName() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span>;
}
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Greeter.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Person.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]) {
  Person p{<span style="color:#e6db74">&#34;Emmanuel&#34;</span>};
  Greeter g;
  std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> g.greet() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
  std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> g.greetTo(p) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>Let&rsquo;s compile and run both our program and our unit testing executable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~/cpp-project-template $ mkdir build
~/cpp-project-template $ cd build
~/cpp-project-template/build $ cmake ..
~/cpp-project-template/build $ make
~/cpp-project-template/build $ ./../bin/cpp-project-template
Hello world!
Hi Emmanuel!
~/cpp-project-template/build $ ./../bin/cpp-project-template-ut
<span style="color:#f92672">[==========]</span> Running <span style="color:#ae81ff">0</span> tests from <span style="color:#ae81ff">0</span> test cases.
<span style="color:#f92672">[==========]</span> <span style="color:#ae81ff">0</span> tests from <span style="color:#ae81ff">0</span> test cases ran. <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> ms total<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>  PASSED  <span style="color:#f92672">]</span> <span style="color:#ae81ff">0</span> tests.
</code></pre></div><p>Everything seems fine, our program is showing the correct output, and the unit testing executable ran zero tests. We will start writing the tests for the <code>Person</code> class. We only need one test for the <code>std::string getName()</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Person.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;gtest/gtest.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
TEST(GreeterTests, PersonGetNameTest) {
  Person p{<span style="color:#e6db74">&#34;Woz&#34;</span>};
  ASSERT_STREQ(p.getName().c_str(), <span style="color:#e6db74">&#34;Woz&#34;</span>);
}
</code></pre></div><p>For the <code>Greeter</code> class, we need to deal with the <code>IPerson</code>. interface. Passing a <code>Person</code> instance might bring us problems. If <code>Person</code> has bugs, our tests will probably be affected. To isolate the testing of <code>Greeter</code> from whatever <code>IPerson</code> implementation we have, we need to implement mock objects. A mock is a simulated object that mimics the behavior of a real object.</p>
<p>To create mocks in our unit testing project, Google Test provides the <a href="https://github.com/google/googletest/blob/master/googlemock/docs/ForDummies.md">Google Mock</a> library. We will define a <code>MockIPerson</code> class that will simulate the behavior for interface <code>IPerson</code>. We will make this mock behave correctly in our <code>Greeter</code> unit tests.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#ifndef __MOCKIPERSON__
</span><span style="color:#75715e">#define __MOCKIPERSON__
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;IPerson.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;gmock/gmock.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MockIPerson</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> IPerson {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  MockIPerson(){}
  <span style="color:#f92672">~</span>MockIPerson(){}
  MOCK_CONST_METHOD0(getName, std<span style="color:#f92672">::</span>string());
};
<span style="color:#75715e">#endif </span><span style="color:#75715e">/** __MOCKIPERSON__ */</span><span style="color:#75715e">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Greeter.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;MockPerson.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;gtest/gtest.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#f92672">::</span>testing<span style="color:#f92672">::</span>Return;

TEST(GreeterTests, GreetTest) {
  Greeter g;
  ASSERT_STREQ(g.greet().c_str(), <span style="color:#e6db74">&#34;Hello world!&#34;</span>);
}
 
TEST(GreeterTests, GreetToTest) {
  MockPerson mockPerson;
  EXPECT_CALL(mockPerson, getName()).WillOnce(Return(<span style="color:#e6db74">&#34;Greg&#34;</span>));
  Greeter g;
  ASSERT_STREQ(g.greetTo(mockPerson).c_str(), <span style="color:#e6db74">&#34;Hi Greg!&#34;</span>);
}
</code></pre></div><p>Notice that, in line 13, we catch the <code>getName()</code> call from our mock. <code>greetTo</code> will call this function, and the mock will return the string we provided. Finally, let&rsquo;s recompile and run our tests.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~/cpp-project-template/build $ cmake ..
~/cpp-project-template/build $ make
~/cpp-project-template/build $ ./../bin/cpp-project-template-ut
<span style="color:#f92672">[[==========]</span> Running <span style="color:#ae81ff">3</span> tests from <span style="color:#ae81ff">1</span> test <span style="color:#66d9ef">case</span>.
<span style="color:#f92672">[</span>----------<span style="color:#f92672">]</span> Global test environment set-up.
<span style="color:#f92672">[</span>----------<span style="color:#f92672">]</span> <span style="color:#ae81ff">3</span> tests from GreeterTests
<span style="color:#f92672">[</span> RUN      <span style="color:#f92672">]</span> GreeterTests.GreetTest
<span style="color:#f92672">[</span>       OK <span style="color:#f92672">]</span> GreeterTests.GreetTest <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> ms<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span> RUN      <span style="color:#f92672">]</span> GreeterTests.GreetToTest
<span style="color:#f92672">[</span>       OK <span style="color:#f92672">]</span> GreeterTests.GreetToTest <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> ms<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span> RUN      <span style="color:#f92672">]</span> GreeterTests.PersonGetNameTest
<span style="color:#f92672">[</span>       OK <span style="color:#f92672">]</span> GreeterTests.PersonGetNameTest <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> ms<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>----------<span style="color:#f92672">]</span> <span style="color:#ae81ff">3</span> tests from GreeterTests <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> ms total<span style="color:#f92672">)</span>

<span style="color:#f92672">[</span>----------<span style="color:#f92672">]</span> Global test environment tear-down
<span style="color:#f92672">[==========]</span> <span style="color:#ae81ff">3</span> tests from <span style="color:#ae81ff">1</span> test <span style="color:#66d9ef">case</span> ran. <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> ms total<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>  PASSED  <span style="color:#f92672">]</span> <span style="color:#ae81ff">3</span> tests.
</code></pre></div><h2 id="where-to-go-next">Where to go next</h2>
<p>The documentation for Google Test is quite extensive. Here is a list of resources you can check to learn how to use this framework:</p>
<ul>
<li><a href="https://github.com/google/googletest/blob/master/googletest/docs/Documentation.md">Google Test documentation</a></li>
<li><a href="https://github.com/google/googletest/tree/master/googlemock/docs">Google Mock documentation</a></li>
</ul>
<p><!-- raw HTML omitted -->Get the code on GitHub<!-- raw HTML omitted --></p>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://eariassoto.github.io/post/coverage/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Analyze the testing coverage of your C&#43;&#43; code</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://eariassoto.github.io/post/first-steps-with-go/">
                  <span class="button__text">First Steps With Go</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Emmanuel Arias</span
    >
    
  
</a>

      <div class="copyright">
        <span
          >© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span>
          <a href="https://github.com/eariassoto/hugo-theme-hello-friend" target="_blank" rel="noopener">Theme</a> created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a>
        </span>
      </div>
    
  </div>
</footer>

<script src="https://eariassoto.github.io/assets/main.js"></script>
<script src="https://eariassoto.github.io/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
